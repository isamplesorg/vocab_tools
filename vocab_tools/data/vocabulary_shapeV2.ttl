@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix skos: <http://www.w3.org/2004/02/skos/core#> .
@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix ish: <https://w3id.org/isample/resource/vocabshape/> .
#
#  pyshacl -s shapes/vocabulary_shape.ttl -m -i rdfs -f human -a -im  -w model/example.ttl
#
# based on vocabulary_shape.ttl from Dave Vieglais vocab_tools repo
# change namespace for rules to an iSamples namespace
# add targets for nodeShapes.

ish:ConceptSchemePresent
    a sh:NodeShape ;
    sh:targetNode skos:ConceptScheme ;
    sh:property [
        sh:path [ sh:inversePath rdf:type ] ;
        sh:minCount 1 ;
        sh:message "There must be at least one ConceptScheme node"
       ]
      .

ish:VocabularyShape
    a sh:NodeShape ;
    sh:targetClass skos:ConceptScheme ;

    sh:property [
        sh:path skos:prefLabel ;
        sh:minCount 1 ;
        sh:nodeKind sh:Literal ;
        sh:message "A vocabulary must have a preferred name"@en ;
        sh:severity sh:Violation  ;
    ] ;
    sh:property [
        sh:path skos:prefLabel ;
        sh:minCount 1 ;
        sh:datatype rdf:langString ;
        sh:message "A vocabulary preferred label should have a language localization (e.g. @en)"@en ;
        sh:severity sh:Warning  ;
    ] ;
    sh:property [
        sh:path skos:definition ;
        sh:minCount 1 ;
        sh:nodeKind sh:Literal ;
        sh:message "A vocabulary must have a definition that describes the scope and content of the vocabulary"@en ;
        sh:severity sh:Violation  ;
    ] ;
    sh:property [
        sh:path skos:definition ;
        sh:minCount 1 ;
        sh:datatype rdf:langString ;
        sh:message "A vocabulary definition should have a language localization (e.g. {@en})"@en ;
        sh:severity sh:Warning ;
    ] ;
    sh:or (
         [ sh:path skos:inScheme ;
                sh:nodeKind sh:IRI ;
                sh:minCount 1 ;
                sh:description "if this is an extension vocabulary, the inScheme property links to the vocabulary it extends"@en;
                    ]
         [ sh:path skos:inScheme ;   sh:maxCount 0;  ]
        ) ;
        sh:message "an iSamples vocabulary must be either a base vocabulary, or an extension vocabulary that has a skos:inScheme property linking it to (possibly transitively) to a base vocabulary. "
.

ish:ConceptNode
    a sh:NodeShape ;
    sh:property [
        sh:path rdf:type ;
        sh:hasValue skos:Concept ;
    ] .

ish:VocabularyConceptSchemeShape
    a sh:NodeShape ;
    sh:targetClass skos:ConceptScheme ;
     sh:property [
        sh:path [ sh:inversePath skos:topConceptOf] ;
        sh:minCount 1 ;
        sh:node ish:ConceptNode ;
        sh:message "there must be at least one topConcept defined in a ConceptScheme, and all subjects of topConceptOf must be skos:Concept"
    ];
.

ish:ConceptInScheme
    a sh:NodeShape;
    sh:targetClass skos:Concept;
    sh:or ( [ sh:path  skos:inScheme ;   sh:minCount 1 ]
           [ sh:path   skos:topConceptOf ;   sh:minCount  1] ) ;
    sh:message "a skos:Concept must be included in a ConceptScheme, either inScheme or topConceptOf."  ;
.

ish:VocabularyConceptShape
    a sh:NodeShape ;
    sh:targetClass skos:Concept ;
    sh:property [
        sh:path skos:prefLabel ;
        sh:minCount 1;
        sh:message "A vocabulary concept must have a preferred name"@en ;
    ] ;
    sh:property [
        sh:path skos:prefLabel ;
        sh:minCount 1;
        sh:datatype rdf:langString ;
        sh:message "A preferred name should be language localized"@en ;
        sh:severity sh:Warning ;
    ] ;
    sh:property [
        sh:path skos:definition ;
        sh:minCount 1;
        sh:message "A vocabulary concept must have a textual definition"@en ;
        sh:severity sh:Violation ;
    ] ;

    sh:property [
        sh:path skos:definition ;
        sh:minCount 1;
        sh:datatype rdf:langString ;
        sh:message "A concept definition should be language localized"@en ;
        sh:severity sh:Warning ;
    ] ;

    .

ish:VocabularyConceptShape2
    a sh:NodeShape ;
    sh:targetClass skos:Concept ;
    # if a concept is not a topConcept, then it must have a skos:broader link
    sh:or (
        [
            sh:and (
                [ sh:path skos:topConceptOf ; sh:maxCount 0 ]
                [ sh:property [ sh:path skos:broader ; sh:minCount 1 ] ]
            )
        ]
        [
            sh:path skos:topConceptOf ; sh:minCount 1
        ]
        );
    sh:message "a concept must either have a broader link or be a topConcept";
    sh:severity sh:Violation ;
.
